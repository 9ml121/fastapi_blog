# Git & VS Code 最佳实践：从修改到推送

> **学习目标**：掌握在 VS Code 中使用 Git 的专业工作流，确保每一次代码提交都清晰、安全、高质量。

## 🚀 核心思想：四步工作法

一个专业、可靠的 Git 提交流程可以总结为四个关键步骤。这个流程的核心是：**绝不直接推送未经验证的代码**。

**检查 (Check) → 整理 (Stage) → 提交 (Commit) → 同步 (Sync)**

---

## 步骤 1: 工作区检查 (Check) - "我改了什么？"

在提交任何代码之前，你必须清晰地知道自己做了哪些修改。这是保证代码质量的第一道防线。

1.  **打开源代码管理视图**:
    *   在 VS Code 左侧活动栏，点击第三个 **源代码管理** 图标 (一个分叉的树枝)。
    *   这里会以列表形式展示所有被修改过的文件。

2.  **逐一审查变更 (Diff)**:
    *   点击列表中的每个文件，VS Code 会打开一个 **差异 (Diff)** 视图。
    *   **红色** 代表删除的内容，**绿色** 代表添加的内容。
    *   **审查要点**:
        *   这次修改是否都是必要的？
        *   是否包含了临时的调试代码 (如 `print()`)？
        *   是否包含被注释掉的旧代码？
        *   修改是否与本次提交的目标无关？

---

## 步骤 2: 暂存区整理 (Stage) - "我要提交什么？"

Git 的“暂存区”(Staging Area) 是一个强大的概念，它允许你精确地控制“本次要提交哪些内容”。**不要把所有修改都一次性提交**。

### “原子化提交” (Atomic Commits)

-   **原则**：一次提交应该只做一件事，并且是完整的一件事。
    -   **好例子**：`feat(auth): 增加密码强度验证` 是一次提交。`fix(api): 修复用户查询的空指针异常` 是另一次提交。
    -   **坏例子**：一次提交同时包含了“增加新功能”和“修复不相关的Bug”。
-   **好处**：
    -   **问题定位**：当代码出问题时，可以快速定位到某次具体的提交。
    -   **代码审查 (Code Review)**：清晰的提交历史让同事更容易理解你的意图。
    -   **安全回滚**：如果某个功能有问题，可以精确地回滚该功能的提交，而不影响其他代码。

### 在 VS Code 中操作

-   在“更改”列表中，对于你希望包含在**下一次提交**中的文件，点击旁边的 `+` 号，将其**暂存**。
-   暂存后，文件会移动到“已暂存的更改”区域。
-   **高级技巧**：如果你只想提交一个文件中的**部分修改**，可以在 Diff 视图中选中那几行代码，右键选择“**暂存所选范围**”。这对于实现“原子化提交”非常有用。

---

## 步骤 3: 精心撰写提交信息 (Commit) - "我为什么提交？"

提交信息 (Commit Message) 是你留给未来自己和同事的“代码日志”，**其重要性等同于编写代码本身**。一个糟糕的提交信息（如 "update code"）是毫无价值的。

### 提交信息规范：Conventional Commits

我们推荐使用 **Conventional Commits** 规范，它已经成为社区标准。

**格式**: `类型(范围): 描述`

-   **`type` (类型)**:
    -   `feat`: 新功能 (feature)
    -   `fix`: 修复 Bug
    -   `docs`: 文档变更
    -   `style`: 代码格式调整（不影响代码逻辑）
    -   `refactor`: 代码重构（既不是新功能也不是修复 Bug）
    -   `test`: 增加或修改测试
    -   `chore`: 构建过程或辅助工具的变动
-   **`scope` (范围, 可选)**: 本次修改影响的范围，如 `auth`, `api`, `db` 等。
-   **`description` (描述)**: 简短、清晰地描述本次提交的目的。

**示例**:
-   `feat(auth): add password strength validation`
-   `fix(api): handle null user in profile endpoint`
-   `docs(readme): update project setup instructions`
-   `refactor(user): switch to repository pattern for data access`

### 在 VS Code 中操作

1.  在源代码管理视图顶部的输入框中，输入你的提交信息。
2.  写完后，点击上方的“**提交**”按钮 (√)。

---

## 步骤 4: 与远程仓库同步 (Sync) - "分享我的代码"

这是最后一步，将你的本地提交推送到 GitHub 等远程仓库。

### 黄金法则：先拉后推 (Pull before Push)

在推送你自己的代码之前，**一定要先从远程仓库拉取 (Pull) 最新的代码**，以合并同事可能已经推送的变更。这可以最大程度地避免冲突。

### 在 VS Code 中操作

VS Code 提供了一个非常智能和安全的功能来完成这个操作。

1.  点击状态栏左下角的“**同步更改**”按钮 (一个循环的箭头图标)。
2.  这个按钮会自动执行两个动作：
    -   `git pull`: 先从远程仓库拉取最新的提交。
    -   `git push`: 再将你的本地提交推送到远程仓库。
3.  **冲突处理**：如果拉取下来的代码和你本地的修改有冲突，VS Code 会暂停同步，并在编辑器中清晰地标出冲突区域，让你手动解决。解决冲突后，再次暂存并提交，然后同步即可。

---

## 📋 快速参考卡片

| 步骤 | 核心问题 | VS Code 操作 | Git 命令 (等效) |
| :--- | :--- | :--- | :--- |
| **1. 检查** | 我改了什么？ | 查看“源代码管理”视图，审查文件差异 | `git status`, `git diff` |
| **2. 整理** | 我要提交什么？ | 点击 `+` 暂存文件或部分更改 | `git add <file>` / `git add -p` |
| **3. 提交** | 我为什么提交？ | 在输入框填写规范的提交信息，点击“提交” | `git commit -m "..."` |
| **4. 同步** | 分享我的代码 | 点击状态栏“同步更改”按钮 | `git pull` 然后 `git push` |
