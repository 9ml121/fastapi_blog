# 注册功能需求文档

> **文档版本**：v1.0  
> **创建日期**：2024-12-16  
> **状态**：待开发  
> **参考设计**：https://crelay.net/#/register

---

## 1. 概述

### 1.1 背景

博客平台需要用户注册功能，让新用户可以创建账户，参与内容创作和社交互动。

### 1.2 目标

实现用户注册页面，完成新用户注册流程，包含邮箱验证功能。

### 1.3 用户人群

- 新用户：希望在博客平台创建账户

---

## 2. 功能需求

### 2.1 功能列表

| 功能              | 优先级    | 说明                 |
| --------------- | ------ | ------------------ |
| 注册表单            | P0     | 邮箱、验证码、密码、确认密码     |
| ==表单验证==        | ==P0== | ==前端实时校验==         |
| ==验证码发送==       | ==P0== | ==发送按钮 + 60 秒倒计时== |
| 注册 API 调用       | P0     | 调用后端接口，处理响应        |
| ==自动登录==            | ==P0==     | ==注册成功后自动登录跳转首页==      |
| 密码显隐切换          | P1     | 点击图标切换密码可见性        |
| Loading 状态      | P1     | 注册中显示加载动画          |
| 错误提示            | P0     | 友好的错误信息展示          |
| ==系统自动生成昵称和头像== | ==P1== |                    |

### 2.2 详细说明

#### 2.2.1 注册表单

**输入字段**：

| 字段 | 类型 | 必填 | 验证规则 | 图标 |
|------|------|------|----------|------|
| 邮箱 | email | ✅ | 非空、邮箱格式 | ✉️ Mail |
| 验证码 | text | ✅ | 非空、6 位数字 | 🔢 KeyRound |
| 密码 | password | ✅ | 非空、至少 8 位 | 🔒 LockKeyhole |
| 确认密码 | password | ✅ | 非空、与密码一致 | 🔒 LockKeyhole |

**交互元素**：

| 元素 | 说明 |
|------|------|
| 获取验证码按钮 | 发送邮箱验证码，发送后显示倒计时 |
| 注册按钮 | 提交表单，显示 Loading 状态 |
| 登录链接 | 「已有账户？立即登录」跳转登录页 |
| 密码显隐图标 | 两个密码字段都支持切换 |

#### 2.2.2 表单验证

| 场景 | 验证时机 | 提示信息 |
|------|----------|----------|
| 邮箱为空 | 失焦/提交 | 请输入邮箱 |
| 邮箱格式错误 | 失焦/提交 | 邮箱格式不正确 |
| 邮箱已被注册 | 发送验证码/API 返回 | 该邮箱已被注册 |
| 验证码为空 | 失焦/提交 | 请输入验证码 |
| 验证码格式错误 | 失焦/提交 | 验证码为 6 位数字 |
| 验证码错误 | API 返回 | 验证码错误或已过期 |
| 密码为空 | 失焦/提交 | 请输入密码 |
| 密码太短 | 失焦/提交 | 密码至少 8 位 |
| 确认密码为空 | 失焦/提交 | 请再次输入密码 |
| 确认密码不一致 | 失焦/提交 | 两次密码输入不一致 |

#### 2.2.3 验证码发送流程

```
用户输入邮箱
    ↓
点击「获取验证码」按钮
    ↓
前端验证邮箱格式 ─── 失败 → 提示邮箱格式错误
    ↓ 成功
调用发送验证码 API
    ↓
后端响应 ─── 失败 → 显示错误（邮箱已注册/发送频繁等）
    ↓ 成功
显示 Toast「验证码已发送」
    ↓
按钮变为「59s」倒计时
    ↓
倒计时结束 → 按钮恢复为「重新获取」
```

#### 2.2.4 注册流程

```
用户填写表单（邮箱、验证码、密码、确认密码）
    ↓
点击注册按钮
    ↓
前端验证 ─── 失败 → 显示错误提示
    ↓ 成功
显示 Loading
    ↓
调用注册 API
    ↓
后端响应 ─── 失败 → 显示错误提示
    ↓ 成功
保存返回的 Token 到 localStorage
    ↓
更新 Pinia 用户状态
    ↓
跳转到首页（已登录状态）
```

---

## 3. UI 设计

### 3.1 页面布局

**参考**：https://crelay.net/#/register

![参考设计截图](./crelay_register_page.png)

### 3.2 布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│                       [导航栏区域]                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│     ┌─────────────────────────────────────────────────────┐     │
│     │                    [Logo]                            │     │
│     │                  CodingNote                          │     │
│     │                                                      │     │
│     │                  创建账户                             │     │
│     │              填写信息完成注册                          │     │
│     │                                                      │     │
│     │  ✉️  [邮箱地址                                   ]   │     │
│     │                                                      │     │
│     │  🔢  [验证码         ] [获取验证码 / 59s]            │     │
│     │                                                      │     │
│     │  🔒  [密码                                     👁]   │     │
│     │                                                      │     │
│     │  🔒  [确认密码                                 👁]   │     │
│     │                                                      │     │
│     │      [          注 册         →]                     │     │
│     │                                                      │     │
│     │      ──────── 已有账户？ ────────                    │     │
│     │                                                      │     │
│     │      [        立即登录        ]                      │     │
│     └─────────────────────────────────────────────────────┘     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 设计要点

| 元素 | 设计规范 |
|------|----------|
| 页面背景 | 与登录页一致（深色渐变/纯色） |
| 卡片 | 白色背景、圆角 16px、阴影 |
| 卡片宽度 | 420px（移动端自适应） |
| Logo | 复用 BrandLogo 组件 |
| 标题 | 「创建账户」大标题 + 「填写信息完成注册」副标题 |
| 输入框 | 复用 FormInput 组件，带图标前缀 |
| 验证码输入框 | 宽度较短，右侧放置发送按钮 |
| 发送按钮 | 倒计时状态：禁用 + 灰色 |
| 注册按钮 | 品牌色、hover 效果、禁用态、Loading 图标 |
| 分隔线 | 「已有账户？」两侧横线 |
| 登录链接 | 次要按钮样式 |

### 3.4 状态变化

#### 验证码按钮状态

| 状态 | 文案 | 样式 |
|------|------|------|
| 初始 | 获取验证码 | 可点击 |
| 发送中 | 发送中... | Loading + 禁用 |
| 倒计时 | 59s | 禁用 + 灰色 |
| 可重发 | 重新获取 | 可点击 |

#### 注册按钮状态

| 状态 | 文案 | 样式 |
|------|------|------|
| 初始 | 注 册 | 可点击 |
| 提交中 | 注册中... | Loading + 禁用 |

---

## 4. 技术依赖

### 4.1 后端 API

#### 4.1.1 发送验证码

| 项目 | 内容 |
|------|------|
| 方法 | POST |
| 路径 | /api/v1/auth/send-code |
| 说明 | 发送邮箱验证码 |

**请求体**：
```json
{
  "email": "user@example.com"
}
```

**成功响应** (200)：
```json
{
  "message": "验证码已发送"
}
```

**失败响应** (400)：
```json
{
  "detail": "该邮箱已被注册"
}
```

#### 4.1.2 用户注册

| 项目 | 内容 |
|------|------|
| 方法 | POST |
| 路径 | /api/v1/auth/register |
| 说明 | 用户注册（自动登录） |

**请求体**：
```json
{
  "email": "user@example.com",
  "code": "123456",
  "password": "password123"
}
```

**成功响应** (201)：
```json
{
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "nickname": "用户_abc123",
    "avatar": "https://ui-avatars.com/api/?name=用户"
  },
  "access_token": "jwt-token-here",
  "token_type": "bearer"
}
```

**失败响应** (400)：
```json
{
  "detail": "验证码错误或已过期"
}
```

### 4.2 前端技术

| 模块 | 技术 | 文件 |
|------|------|------|
| 页面组件 | Vue 3 | `views/RegisterView.vue` |
| 表单输入 | 复用组件 | `components/FormInput.vue` |
| 品牌 Logo | 复用组件 | `components/BrandLogo.vue` |
| HTTP 请求 | Axios | `modules/auth/api.ts` |
| 状态管理 | Pinia | `modules/auth/auth.store.ts` |
| 路由 | Vue Router | `router/index.ts` |

### 4.3 新增/修改文件

| 文件 | 操作 | 说明 |
|------|------|------|
| `views/RegisterView.vue` | 新增 | 注册页面组件 |
| `modules/auth/api.ts` | 修改 | 新增 sendCode、register API |
| `modules/auth/auth.store.ts` | 修改 | 新增 register action |
| `router/index.ts` | 修改 | 新增 /register 路由 |

---

## 5. Mock 策略

在后端 API 未就绪时，使用以下 Mock 策略：

### 5.1 发送验证码 Mock

```typescript
async function mockSendCode(email: string) {
  await delay(500) // 模拟网络延迟
  const code = Math.random().toString().slice(2, 8) // 生成 6 位随机数
  console.log(`📧 Mock 验证码: ${code}`) // 控制台打印
  return { message: '验证码已发送' }
}
```

### 5.2 注册 Mock

```typescript
async function mockRegister(data: RegisterParams) {
  await delay(800)
  return {
    user: {
      id: 'mock-user-id',
      email: data.email,
      nickname: `用户_${Math.random().toString(36).slice(2, 8)}`,
      avatar: `https://ui-avatars.com/api/?name=User&background=random`
    },
    access_token: 'mock-jwt-token',
    token_type: 'bearer'
  }
}
```

---

## 6. 验收标准

### 6.1 功能验收

- [ ] 注册表单正确展示所有字段（邮箱、验证码、密码、确认密码）
- [ ] 表单验证正常工作（前端实时校验）
- [ ] 验证码发送按钮点击后显示 60 秒倒计时
- [ ] 倒计时结束后按钮恢复可点击状态
- [ ] 验证码输入前邮箱格式需正确
- [ ] 注册成功后自动登录并跳转首页
- [ ] 邮箱重复时显示正确错误提示
- [ ] 验证码错误时显示正确错误提示

### 6.2 UI 验收

- [ ] 页面布局与登录页风格一致
- [ ] 页面居中显示，卡片样式正确
- [ ] 输入框带图标前缀
- [ ] 密码显隐切换功能正常
- [ ] 验证码按钮状态变化正确
- [ ] 注册按钮 Loading 状态正确
- [ ] 错误提示清晰可见
- [ ] 移动端响应式适配正常

---

## 7. 后续扩展（Phase 5+）

| 功能 | 说明 |
|------|------|
| 真实邮件发送 | 接入 SMTP/第三方邮件服务 |
| 密码强度指示器 | 弱/中/强 可视化提示 |
| 验证码发送频率限制 | 同一邮箱 60 秒限制 |
| IP 频率限制 | 防止批量注册攻击 |
| 第三方登录 | GitHub/Google OAuth |

---
