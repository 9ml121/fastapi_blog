# 用户认证扩展需求文档

> **文档版本**：v1.0  
> **创建日期**：2024-12-16  
> **状态**：待开发  
> **开发模式**：前后端分离（先前端 UI，后端 Mock）

---

## 1. 概述

### 1.1 背景

Phase 3 完成了登录功能的基础实现。Phase 4 需要扩展用户认证体系，完善用户注册、导航交互和个人信息展示，形成完整的用户身份管理闭环。

### 1.2 目标

| 目标 | 说明 |
|------|------|
| 注册功能 | 新用户可以创建账户 |
| 导航栏 | 全局导航，动态展示登录状态 |
| 登出功能 | 用户可以安全退出 |
| 个人中心 | 查看个人信息 |

### 1.3 用户人群

- 新用户：需要注册账户
- 已有用户：需要查看个人信息、登出

---

## 2. 功能需求

### 2.1 功能列表总览

| 功能 | 优先级 | 复杂度 | 说明 |
|------|--------|--------|------|
| 注册页面 | P0 | ⭐⭐ | 复用登录页样式 |
| 导航栏组件 | P0 | ⭐⭐⭐ | 全局导航 + 用户状态 |
| 登出功能 | P0 | ⭐ | 集成在导航栏/个人中心 |
| 个人中心页 | P1 | ⭐⭐ | 展示用户信息 |

---

## 3. 功能详细需求

### 3.1 注册页面

#### 3.1.1 功能描述

用户通过填写注册表单创建新账户，复用登录页的 UI 样式和组件结构。

#### 3.1.2 输入字段

| 字段 | 类型 | 必填 | 验证规则 |
|------|------|------|----------|
| 用户名 | text | ✅ | 非空、4-20 字符、字母数字下划线 |
| 邮箱 | email | ✅ | 非空、邮箱格式 |
| 密码 | password | ✅ | 非空、至少 8 位 |
| 确认密码 | password | ✅ | 与密码一致 |

#### 3.1.3 交互元素

| 元素 | 说明 |
|------|------|
| 注册按钮 | 提交表单，显示 Loading 状态 |
| 登录链接 | 「已有账户？去登录」跳转登录页 |
| 密码显隐 | 密码和确认密码字段都支持切换 |

#### 3.1.4 表单验证

| 场景 | 验证时机 | 提示信息 |
|------|----------|----------|
| 用户名为空 | 失焦/提交 | 请输入用户名 |
| 用户名格式错误 | 失焦/提交 | 用户名只能包含字母、数字、下划线 |
| 邮箱为空 | 失焦/提交 | 请输入邮箱 |
| 邮箱格式错误 | 失焦/提交 | 邮箱格式不正确 |
| 密码为空 | 失焦/提交 | 请输入密码 |
| 密码太短 | 失焦/提交 | 密码至少 8 位 |
| 确认密码不一致 | 失焦/提交 | 两次密码输入不一致 |
| 用户名已存在 | API 返回 | 该用户名已被使用 |
| 邮箱已存在 | API 返回 | 该邮箱已被注册 |

#### 3.1.5 注册流程

```
用户打开注册页
    ↓
填写表单（用户名、邮箱、密码、确认密码）
    ↓
点击注册按钮
    ↓
前端验证 ─── 失败 → 显示错误提示
    ↓ 成功
显示 Loading
    ↓
调用注册 API
    ↓
后端响应 ─── 失败 → 显示错误提示
    ↓ 成功
提示注册成功
    ↓
自动跳转登录页（或自动登录）
```

---

### 3.2 导航栏组件

#### 3.2.1 功能描述

全局导航栏组件，固定在页面顶部，根据用户登录状态显示不同内容。

#### 3.2.2 布局结构

```
┌────────────────────────────────────────────────────────────────┐
│  [Logo]     [首页] [文章] [编辑器]           [用户头像▼] / [登录] │
└────────────────────────────────────────────────────────────────┘
     ↓                    ↓                           ↓
   品牌标识            主导航链接               用户操作区（动态）
```

#### 3.2.3 导航区域

| 区域 | 元素 | 说明 |
|------|------|------|
| **左侧** | Logo + 品牌名 | 点击返回首页 |
| **中间** | 导航链接 | 首页、文章列表、编辑器等 |
| **右侧（未登录）** | 登录/注册按钮 | 跳转对应页面 |
| **右侧（已登录）** | 用户头像 + 下拉菜单 | 个人中心、登出 |

#### 3.2.4 用户下拉菜单

| 菜单项 | 图标 | 说明 |
|--------|------|------|
| 个人中心 | 👤 | 跳转个人中心页 |
| 分割线 | — | — |
| 退出登录 | 🚪 | 执行登出操作 |

#### 3.2.5 交互要求

| 交互 | 说明 |
|------|------|
| 下拉菜单触发 | 点击头像显示，点击外部关闭 |
| 当前路由高亮 | 导航链接高亮当前页面 |
| 响应式适配 | 移动端收起为汉堡菜单（可选 P2） |

---

### 3.3 登出功能

#### 3.3.1 功能描述

用户点击登出后，清除本地凭证，跳转到登录页。

#### 3.3.2 触发位置

- 导航栏用户下拉菜单
- 个人中心页（可选）

#### 3.3.3 登出流程

```
用户点击「退出登录」
    ↓
清除 localStorage 中的 Token
    ↓
清除 Pinia Store 中的用户状态
    ↓
跳转到登录页
    ↓
显示提示「已成功登出」（可选）
```

---

### 3.4 个人中心页

#### 3.4.1 功能描述

展示当前登录用户的基本信息，提供账户管理入口。

#### 3.4.2 页面布局

```
┌─────────────────────────────────────────────────────┐
│                    导航栏                            │
├─────────────────────────────────────────────────────┤
│                                                      │
│     ┌─────────────────────────────────────────┐     │
│     │            用户头像（大）                  │     │
│     │            用户名                        │     │
│     │            邮箱                          │     │
│     │            注册时间                       │     │
│     └─────────────────────────────────────────┘     │
│                                                      │
│     [编辑资料]  [修改密码]  （可选，P2）             │
│                                                      │
└─────────────────────────────────────────────────────┘
```

#### 3.4.3 展示字段

| 字段 | 说明 |
|------|------|
| 用户头像 | 默认头像或用户上传头像 |
| 用户名 | 显示用户名 |
| 邮箱 | 显示邮箱（部分隐藏） |
| 昵称 | 显示昵称（如有） |
| 注册时间 | 显示账户创建时间 |

#### 3.4.4 权限要求

- **需要登录**：未登录用户访问时跳转登录页

---

## 4. UI 设计规范

### 4.1 注册页面

| 元素 | 设计要点 |
|------|----------|
| 整体布局 | 与登录页保持一致，卡片居中 |
| 表单样式 | 复用 `FormInput` 组件 |
| 品牌标识 | 复用 `BrandLogo` 组件 |
| 配色 | 与登录页保持一致 |

### 4.2 导航栏

| 元素 | 设计要点 |
|------|----------|
| 高度 | 60px |
| 背景 | 主题背景色 + 底部边框 |
| Logo | 品牌色，hover 有交互 |
| 导航链接 | 间距均匀，当前页高亮 |
| 用户头像 | 圆形，32-40px |
| 下拉菜单 | 白色背景、圆角阴影 |

### 4.3 个人中心页

| 元素 | 设计要点 |
|------|----------|
| 头像 | 大尺寸 (80-120px)，圆形 |
| 信息卡片 | 白色背景、圆角阴影 |
| 排版 | 信息左对齐或居中 |

---

## 5. 技术依赖

### 5.1 后端 API（Mock / 真实）

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 注册 | POST | /api/v1/auth/register | 创建新用户 |
| 获取当前用户 | GET | /api/v1/users/me | 需 Token，返回用户信息 |

#### 注册 API

**请求体**：
```json
{
  "username": "string",  
  "email": "string",
  "password": "string",
  "nickname": "string"  // 可选
}
```

**成功响应** (201)：
```json
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  "nickname": "string",
  "created_at": "datetime"
}
```

#### 获取当前用户 API

**请求头**：`Authorization: Bearer <token>`

**成功响应** (200)：
```json
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  "nickname": "string",
  "avatar": "string | null",
  "created_at": "datetime"
}
```

### 5.2 前端文件规划

| 模块 | 文件 | 说明 |
|------|------|------|
| 注册页面 | `views/RegisterView.vue` | 注册表单页面 |
| 导航栏 | `components/NavBar.vue` | 全局导航组件 |
| 用户菜单 | `components/UserMenu.vue` | 下拉菜单组件 |
| 个人中心 | `views/ProfileView.vue` | 个人信息页 |
| Auth API | `modules/auth/api.ts` | 新增注册 API |
| Auth Store | `modules/auth/auth.store.ts` | 新增用户信息状态 |

---

## 6. 验收标准

### 6.1 注册功能

- [ ] 注册表单正确展示所有字段
- [ ] 表单验证正常工作（前端实时校验）
- [ ] 注册成功后跳转登录页
- [ ] 用户名/邮箱重复时显示正确错误提示
- [ ] 页面样式与登录页风格一致

### 6.2 导航栏

- [ ] 未登录显示「登录」「注册」按钮
- [ ] 已登录显示用户头像和下拉菜单
- [ ] 导航链接能正常跳转
- [ ] 当前页面对应链接高亮
- [ ] 下拉菜单点击外部可关闭

### 6.3 登出功能

- [ ] 点击登出后清除 Token
- [ ] 登出后跳转到登录页
- [ ] 登出后导航栏显示未登录状态

### 6.4 个人中心

- [ ] 正确展示用户信息
- [ ] 未登录访问时跳转登录页
- [ ] 页面布局美观

---

## 7. 开发顺序建议

根据依赖关系，建议按以下顺序开发：

| 顺序 | 任务 | 依赖 |
|------|------|------|
| 1 | 注册页面 UI | 无（复用现有组件） |
| 2 | 注册 API 调用 | 注册页面 |
| 3 | 导航栏组件 | 无 |
| 4 | 用户状态集成 | Auth Store |
| 5 | 登出功能 | 导航栏、Auth Store |
| 6 | 个人中心页 | 导航栏、/me API |

---

## 8. Mock 数据策略

在后端 API 未就绪时，可使用以下 Mock 策略：

### 8.1 注册 Mock

```typescript
// 临时 Mock 注册，成功直接跳转登录页
async function mockRegister(data: RegisterParams) {
  await delay(500) // 模拟网络延迟
  console.log('Mock 注册成功:', data)
  return { success: true }
}
```

### 8.2 用户信息 Mock

```typescript
// Mock 当前用户信息
const mockUser = {
  id: 'mock-user-id',
  username: 'testuser',
  email: 'test@example.com',
  nickname: '测试用户',
  avatar: null,
  created_at: '2024-01-01T00:00:00Z'
}
```

---

## 9. 参考设计

可参考以下产品的注册/导航设计：

- 掘金：https://juejin.cn
- 知乎：https://zhihu.com
- GitHub：https://github.com

---
