
> æœ¬æ–‡æ¡£è¯¦ç»†è®²è§£æ‚¨åœ¨Â `MarkdownEditor.vue`Â ä¸­ä½¿ç”¨çš„ Vue 3 æ ¸å¿ƒæ¦‚å¿µã€‚

---

## 1. ref æ¨¡æ¿å¼•ç”¨ï¼ˆTemplate Refsï¼‰

### ğŸ“š æ¦‚å¿µ

**ref**Â ç”¨äºè·å– DOM å…ƒç´ æˆ–ç»„ä»¶å®ä¾‹çš„å¼•ç”¨ã€‚

### ğŸ”§ åŸºæœ¬ç”¨æ³•

```vue
<template>
  <EditorContent ref="editorContentRef" />
</template>

<script setup>
import { ref } from 'vue'

const editorContentRef = ref()
//    â†‘ åˆ›å»ºå“åº”å¼å¼•ç”¨
//    åˆå§‹å€¼ä¸º undefined
</script>
```

### ğŸ’¡ å·¥ä½œåŸç†

```
1. åˆ›å»º ref
   const editorContentRef = ref()
   â†“
2. æ¨¡æ¿ç»‘å®š
   <EditorContent ref="editorContentRef" />
   â†“
3. ç»„ä»¶æŒ‚è½½å
   editorContentRef.value = EditorContentç»„ä»¶å®ä¾‹
   â†“
4. è®¿é—®ç»„ä»¶æ–¹æ³•
   editorContentRef.value?.applyInlineFormat('bold')
```

### âš ï¸ é‡è¦æ¦‚å¿µ

**ref() vs ref=""**ï¼š

```typescript
// JavaScript ä¸­ï¼šåˆ›å»ºå“åº”å¼å¼•ç”¨
const editorContentRef = ref()

// æ¨¡æ¿ä¸­ï¼šç»‘å®šåˆ°ç»„ä»¶
<EditorContent ref="editorContentRef" />
//             â†‘ è¿™é‡Œä¸éœ€è¦ .value
```

**ä½•æ—¶å¯ä»¥è®¿é—®**ï¼š

```typescript
import { onMounted } from 'vue'

// âŒ é”™è¯¯ï¼šç»„ä»¶è¿˜æœªæŒ‚è½½
console.log(editorContentRef.value) // undefined

onMounted(() => {
  // âœ… æ­£ç¡®ï¼šç»„ä»¶å·²æŒ‚è½½
  console.log(editorContentRef.value) // EditorContentå®ä¾‹
})
```

### ğŸ“– å®é™…ä¾‹å­

```vue
<template>
  <div>
    <input ref="inputRef" />
    <button @click="focusInput">èšç„¦è¾“å…¥æ¡†</button>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const inputRef = ref()

const focusInput = () => {
  inputRef.value?.focus() // è°ƒç”¨DOMæ–¹æ³•
}
</script>
```

---

## 2. v-model åŒå‘ç»‘å®š

### ğŸ“š æ¦‚å¿µ

**v-model**Â æ˜¯è¯­æ³•ç³–ï¼Œå®ç°çˆ¶å­ç»„ä»¶çš„æ•°æ®åŒå‘åŒæ­¥ã€‚

### ğŸ”§ åŸç†è§£æ

**è¯­æ³•ç³–**ï¼š

```vue
<!-- ç®€å†™ -->
<MarkdownEditor v-model="content" />

<!-- å±•å¼€åçš„å®Œæ•´å†™æ³• -->
<MarkdownEditor :modelValue="content" @update:modelValue="content = $event" />
```

**æµç¨‹å›¾**ï¼š

```
çˆ¶ç»„ä»¶æ•°æ®å˜åŒ–
    â†“
ä¼ é€’ç»™å­ç»„ä»¶ï¼ˆ:modelValueï¼‰
    â†“
å­ç»„ä»¶ä½¿ç”¨æ•°æ®
    â†“
å­ç»„ä»¶æ•°æ®å˜åŒ–
    â†“
å‘å‡ºäº‹ä»¶ï¼ˆ@update:modelValueï¼‰
    â†“
çˆ¶ç»„ä»¶æ›´æ–°æ•°æ®
```

### ğŸ’¡ å­ç»„ä»¶å®ç°

```typescript
// 1. å®šä¹‰ Props
interface Props {
  modelValue?: string
}
const props = defineProps<Props>()

// 2. å®šä¹‰ Emits
interface Emits {
  (e: 'update:modelValue', value: string): void
}
const emit = defineEmits<Emits>()

// 3. åˆ›å»ºæœ¬åœ°æ•°æ®
const content = ref(props.modelValue || '')

// 4. ç›‘å¬ Props å˜åŒ–
watch(
  () => props.modelValue,
  (newValue) => {
    if (newValue !== undefined) {
      content.value = newValue
    }
  },
)

// 5. æ•°æ®å˜åŒ–æ—¶å‘å‡ºäº‹ä»¶
const handleChange = (newValue: string) => {
  content.value = newValue
  emit('update:modelValue', newValue)
}
```

### ğŸ“– å®Œæ•´ä¾‹å­

**å­ç»„ä»¶ï¼ˆMyInput.vueï¼‰**ï¼š

```vue
<template>
  <input :value="modelValue" @input="$emit('update:modelValue', $event.target.value)" />
</template>

<script setup>
defineProps<{ modelValue?: string }>()
defineEmits<{ (e: 'update:modelValue', value: string): void }>()
</script>
```

**çˆ¶ç»„ä»¶**ï¼š

```vue
<template>
  <div>
    <MyInput v-model="text" />
    <p>è¾“å…¥çš„å†…å®¹ï¼š{{ text }}</p>
  </div>
</template>

<script setup>
import { ref } from 'vue'
const text = ref('')
</script>
```

### ğŸ¯ å¤šä¸ª v-model

```vue
<!-- çˆ¶ç»„ä»¶ -->
<MarkdownEditor v-model="content" v-model:title-value="title" />

<!-- ç­‰ä»·äº -->
<MarkdownEditor
  :modelValue="content"
  @update:modelValue="content = $event"
  :titleValue="title"
  @update:titleValue="title = $event"
/>
```

---

## 3. Props å’Œ Emits ç±»å‹å®šä¹‰

### ğŸ“š Props æ¦‚å¿µ

**Props**Â æ˜¯çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„æ•°æ®ã€‚

### ğŸ”§ å®šä¹‰æ–¹å¼

```typescript
// æ–¹å¼1ï¼šinterface + defineProps
interface Props {
  modelValue?: string // å¯é€‰
  title: string // å¿…éœ€
  count: number // å¿…éœ€
}

const props = defineProps<Props>()

// æ–¹å¼2ï¼šwithDefaults è®¾ç½®é»˜è®¤å€¼
interface Props {
  modelValue?: string
  showTitle?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  showTitle: true, // é»˜è®¤å€¼
})
```

### ğŸ“– ä½¿ç”¨ Props

```typescript
// åœ¨ script ä¸­è®¿é—®
console.log(props.modelValue)
console.log(props.showTitle)

// åœ¨æ¨¡æ¿ä¸­è®¿é—®ï¼ˆè‡ªåŠ¨è§£æ„ï¼‰
<div v-if="showTitle">...</div>
```

### ğŸ“š Emits æ¦‚å¿µ

**Emits**Â æ˜¯å­ç»„ä»¶å‘çˆ¶ç»„ä»¶å‘å‡ºçš„äº‹ä»¶ã€‚

### ğŸ”§ å®šä¹‰æ–¹å¼

```typescript
// å®šä¹‰äº‹ä»¶ç±»å‹
interface Emits {
  (e: 'update:modelValue', value: string): void
  (e: 'change', content: string, title: string): void
  (e: 'save'): void
}

const emit = defineEmits<Emits>()

// å‘å‡ºäº‹ä»¶
emit('update:modelValue', 'new content')
emit('change', content.value, title.value)
emit('save')
```

### ğŸ“– å®Œæ•´ä¾‹å­

**å­ç»„ä»¶ï¼ˆCounter.vueï¼‰**ï¼š

```vue
<template>
  <div>
    <p>Count: {{ count }}</p>
    <button @click="increment">+1</button>
  </div>
</template>

<script setup>
interface Props {
  count: number
}

interface Emits {
  (e: 'update:count', value: number): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const increment = () => {
  emit('update:count', props.count + 1)
}
</script>
```

**çˆ¶ç»„ä»¶**ï¼š

```vue
<template>
  <Counter v-model:count="counter" />
</template>

<script setup>
import { ref } from 'vue'
const counter = ref(0)
</script>
```

---

## 4. watch ç›‘å¬å™¨

### ğŸ“š æ¦‚å¿µ

**watch**Â ç”¨äºç›‘å¬å“åº”å¼æ•°æ®çš„å˜åŒ–å¹¶æ‰§è¡Œå›è°ƒã€‚

### ğŸ”§ åŸºæœ¬ç”¨æ³•

```typescript
// ç›‘å¬å•ä¸ª ref
const count = ref(0)

watch(count, (newValue, oldValue) => {
  console.log(`ä» ${oldValue} å˜ä¸º ${newValue}`)
})

// ç›‘å¬ Props
watch(
  () => props.modelValue,
  (newValue) => {
    console.log('modelValue å˜åŒ–:', newValue)
  },
)

// ç«‹å³æ‰§è¡Œ
watch(
  count,
  (newValue) => {
    console.log(newValue)
  },
  { immediate: true },
)
```

### ğŸ’¡ watch vs watchEffect

```typescript
// watchï¼šéœ€è¦æ˜ç¡®æŒ‡å®šç›‘å¬æº
watch(
  () => props.modelValue,
  (newValue) => {
    content.value = newValue
  },
)

// watchEffectï¼šè‡ªåŠ¨è¿½è¸ªä¾èµ–
watchEffect(() => {
  // è‡ªåŠ¨ç›‘å¬ props.modelValue
  content.value = props.modelValue
})
```

### ğŸ“– å®é™…åº”ç”¨

**åŒæ­¥å¤–éƒ¨æ•°æ®åˆ°å†…éƒ¨çŠ¶æ€**ï¼š

```typescript
// MarkdownEditor.vue
const content = ref(props.modelValue || '')

// å½“çˆ¶ç»„ä»¶æ›´æ–° modelValue æ—¶ï¼ŒåŒæ­¥åˆ° content
watch(
  () => props.modelValue,
  (newValue) => {
    if (newValue !== undefined) {
      content.value = newValue
    }
  },
)
```

**ç›‘å¬å¤šä¸ªæº**ï¼š

```typescript
watch([() => props.modelValue, () => props.titleValue], ([newContent, newTitle]) => {
  console.log('å†…å®¹:', newContent)
  console.log('æ ‡é¢˜:', newTitle)
})
```

---

## 5. defineExpose æš´éœ² API

### ğŸ“š æ¦‚å¿µ

**defineExpose**Â ç”¨äºæš´éœ²å­ç»„ä»¶çš„æ–¹æ³•å’Œæ•°æ®ç»™çˆ¶ç»„ä»¶ã€‚

### ğŸ”§ åŸºæœ¬ç”¨æ³•

**å­ç»„ä»¶**ï¼š

```typescript
// å†…éƒ¨æ–¹æ³•
const getContent = () => content.value
const setContent = (value: string) => {
  content.value = value
}

// æš´éœ²ç»™çˆ¶ç»„ä»¶
defineExpose({
  getContent,
  setContent,
  editorContent: editorContentRef,
})
```

**çˆ¶ç»„ä»¶**ï¼š

```vue
<template>
  <MarkdownEditor ref="editorRef" />
  <button @click="saveContent">ä¿å­˜</button>
</template>

<script setup>
import { ref } from 'vue'

const editorRef = ref()

const saveContent = () => {
  const content = editorRef.value.getContent()
  console.log('ä¿å­˜å†…å®¹:', content)
}
</script>
```

### ğŸ“– å®Œæ•´ä¾‹å­

**å­ç»„ä»¶ï¼ˆForm.vueï¼‰**ï¼š

```vue
<script setup>
import { ref } from 'vue'

const formData = ref({ name: '', email: '' })

const validate = () => {
  return formData.value.name && formData.value.email
}

const reset = () => {
  formData.value = { name: '', email: '' }
}

// æš´éœ²æ–¹æ³•
defineExpose({
  validate,
  reset,
  getData: () => formData.value,
})
</script>
```

**çˆ¶ç»„ä»¶**ï¼š

```vue
<template>
  <Form ref="formRef" />
  <button @click="submit">æäº¤</button>
</template>

<script setup>
const formRef = ref()

const submit = () => {
  if (formRef.value.validate()) {
    const data = formRef.value.getData()
    console.log('è¡¨å•æ•°æ®:', data)
  }
}
</script>
```

---

## 6. withDefaults è®¾ç½®é»˜è®¤å€¼

### ğŸ“š æ¦‚å¿µ

**withDefaults**Â ä¸º Props è®¾ç½®é»˜è®¤å€¼ï¼ˆTypeScriptï¼‰ã€‚

### ğŸ”§ åŸºæœ¬ç”¨æ³•

```typescript
interface Props {
  title?: string
  showToolbar?: boolean
  maxLength?: number
}

const props = withDefaults(defineProps<Props>(), {
  title: 'é»˜è®¤æ ‡é¢˜',
  showToolbar: true,
  maxLength: 1000,
})
```

### ğŸ’¡ å¯¹æ¯”

**ä¸ä½¿ç”¨ withDefaults**ï¼š

```typescript
const props = defineProps<Props>()

// éœ€è¦æ‰‹åŠ¨å¤„ç†é»˜è®¤å€¼
const title = props.title || 'é»˜è®¤æ ‡é¢˜'
const showToolbar = props.showToolbar ?? true
```

**ä½¿ç”¨ withDefaults**ï¼š

```typescript
const props = withDefaults(defineProps<Props>(), {
  title: 'é»˜è®¤æ ‡é¢˜',
  showToolbar: true,
})

// ç›´æ¥ä½¿ç”¨
console.log(props.title) // å¦‚æœæœªä¼ ï¼Œè‡ªåŠ¨æ˜¯'é»˜è®¤æ ‡é¢˜'
```

---

## ğŸ“š æ€»ç»“å¯¹ç…§è¡¨

| æ¦‚å¿µ             | ä½œç”¨             | MarkdownEditor.vue ä¸­çš„åº”ç”¨                      |
| ---------------- | ---------------- | ------------------------------------------------ |
| **ref æ¨¡æ¿å¼•ç”¨** | è·å–ç»„ä»¶å®ä¾‹     | `editorContentRef`Â ç”¨äºè°ƒç”¨ EditorContent çš„æ–¹æ³• |
| **v-model**      | åŒå‘ç»‘å®š         | `v-model="content"`Â å®ç°ç¼–è¾‘å™¨å†…å®¹åŒæ­¥           |
| **Props**        | æ¥æ”¶çˆ¶ç»„ä»¶æ•°æ®   | `modelValue`ã€`titleValue`ã€`showTitle`          |
| **Emits**        | å‘çˆ¶ç»„ä»¶å‘é€äº‹ä»¶ | `update:modelValue`ã€`change`                    |
| **watch**        | ç›‘å¬æ•°æ®å˜åŒ–     | ç›‘å¬ Props å˜åŒ–å¹¶åŒæ­¥åˆ°å†…éƒ¨çŠ¶æ€                  |
| **defineExpose** | æš´éœ²å­ç»„ä»¶ API   | æš´éœ²Â `getContent`ã€`setContent`Â ç­‰æ–¹æ³•           |
| **withDefaults** | è®¾ç½®é»˜è®¤å€¼       | `showTitle`Â é»˜è®¤ä¸ºÂ `true`                        |

---

## ğŸ¯ å­¦ä¹ å»ºè®®

1. **å¾ªåºæ¸è¿›**ï¼š
   - å…ˆæŒæ¡ ref å’Œ v-model
   - å†ç†è§£ Props/Emits
   - æœ€åå­¦ä¹  watch å’Œ defineExpose

2. **å®è·µä¸ºä¸»**ï¼š
   - å¤šå†™å°ä¾‹å­
   - çœ‹å®˜æ–¹æ–‡æ¡£ç¤ºä¾‹
   - è°ƒè¯•æŸ¥çœ‹æ•°æ®æµ

3. **ç†è§£åŸç†**ï¼š
   - v-model æ˜¯è¯­æ³•ç³–
   - Props æ˜¯å•å‘æ•°æ®æµ
   - Emits æ˜¯äº‹ä»¶é€šä¿¡

---

