# å†å²è®°å½•ç®¡ç†ç³»ç»Ÿï¼ˆUndo/Redoï¼‰è®¾è®¡æ–‡æ¡£

## ä¸€ã€ä»€ä¹ˆæ˜¯å†å²è®°å½•ç®¡ç†ï¼Ÿ

### 1.1 æ ¸å¿ƒæ¦‚å¿µ

**å†å²è®°å½•ç®¡ç†**å°±æ˜¯å®ç°ç¼–è¾‘å™¨çš„"æ—¶é—´æ—…è¡Œ"åŠŸèƒ½ï¼š

- **Undoï¼ˆæ’¤é”€ï¼‰**ï¼šå›åˆ°è¿‡å»ï¼ˆCtrl+Zï¼‰
- **Redoï¼ˆé‡åšï¼‰**ï¼šå›åˆ°æœªæ¥ï¼ˆCtrl+Shift+Zï¼‰

### 1.2 ç”Ÿæ´»ä¸­çš„æ¯”å–»

æƒ³è±¡ä½ åœ¨ç©ä¸€ä¸ªæ¸¸æˆï¼Œæ¸¸æˆè‡ªåŠ¨ä¿å­˜äº†æ¯ä¸€ä¸ªå…³é”®èŠ‚ç‚¹çš„**å­˜æ¡£**ï¼š

```
å­˜æ¡£1: åˆšè¿›å…¥ç¬¬ä¸€å…³
å­˜æ¡£2: æ‰“è´¥äº†ç¬¬ä¸€ä¸ª Boss
å­˜æ¡£3: è·å¾—äº†å®å‰‘
å­˜æ¡£4: è¿›å…¥ç¬¬äºŒå…³
         â†‘ ä½ ç°åœ¨åœ¨è¿™é‡Œ
```

- **æ’¤é”€ï¼ˆUndoï¼‰**ï¼šè¯»å–å­˜æ¡£3ï¼Œå›åˆ°è·å¾—å®å‰‘çš„æ—¶åˆ»
- **é‡åšï¼ˆRedoï¼‰**ï¼šé‡æ–°è¯»å–å­˜æ¡£4ï¼Œå›åˆ°ç¬¬äºŒå…³

**å…³é”®ç‚¹**ï¼šå¦‚æœä½ åœ¨å­˜æ¡£3åšäº†æ–°çš„é€‰æ‹©ï¼ˆæ¯”å¦‚å»äº†å•†åº—ï¼‰ï¼Œé‚£ä¹ˆåŸæ¥çš„å­˜æ¡£4å°±å¤±æ•ˆäº†ï¼ˆå› ä¸ºå†å²è¢«æ”¹å˜äº†ï¼‰ã€‚

---

## äºŒã€ä¸ºä»€ä¹ˆéœ€è¦å†å²è®°å½•ï¼Ÿ

### 2.1 ç”¨æˆ·ä½“éªŒ

ç”¨æˆ·åœ¨ç¼–è¾‘æ—¶ç»å¸¸ä¼šï¼š

- è¯¯åˆ äº†ä¸€æ®µæ–‡å­— â†’ éœ€è¦æ’¤é”€
- æ”¹äº†ä¸€ä¸ªæ ¼å¼è§‰å¾—ä¸å¥½çœ‹ â†’ éœ€è¦æ’¤é”€
- æ’¤é”€å¤šäº†æƒ³å›å» â†’ éœ€è¦é‡åš

### 2.2 è¡Œä¸šæ ‡å‡†

å‡ ä¹æ‰€æœ‰ç°ä»£ç¼–è¾‘å™¨éƒ½æ”¯æŒ Undo/Redoï¼š

- **VS Code**ï¼šåŸºäº Monaco Editor çš„å†å²æ ˆ
- **Google Docs**ï¼šåŸºäº Operation Transform
- **Notion**ï¼šåŸºäº Block-level å†å²
- **ProseMirror**ï¼šåŸºäº Step-based å†å²

---

## ä¸‰ã€å®ç°æ–¹æ¡ˆå¯¹æ¯”

### 3.1 æ–¹æ¡ˆä¸€ï¼šå¿«ç…§å¼ï¼ˆSnapshot-basedï¼‰âœ… æ¨èæ–°æ‰‹

**åŸç†**ï¼šæ¯æ¬¡æ“ä½œåï¼Œä¿å­˜æ•´ä¸ªæ–‡æ¡£çš„**å®Œæ•´å‰¯æœ¬**ã€‚

#### ä¼˜ç‚¹

- âœ… **å®ç°ç®€å•**ï¼šä¸éœ€è¦å¤æ‚çš„é€»è¾‘ï¼Œç›´æ¥å­˜æ•´ä¸ªå†…å®¹
- âœ… **æ¢å¤å¿«é€Ÿ**ï¼šæ’¤é”€æ—¶ç›´æ¥æ›¿æ¢æ•´ä¸ªå†…å®¹
- âœ… **ä¸æ˜“å‡ºé”™**ï¼šæ²¡æœ‰å¢é‡è®¡ç®—ï¼Œä¸ä¼šæœ‰ç´¯ç§¯è¯¯å·®

#### ç¼ºç‚¹

- âŒ **å†…å­˜å ç”¨å¤§**ï¼šæ¯ä¸ªå¿«ç…§éƒ½æ˜¯å®Œæ•´å†…å®¹ï¼Œå¦‚æœæ–‡æ¡£å¾ˆå¤§ï¼ˆ10MBï¼‰ï¼Œä¿å­˜50ä¸ªå¿«ç…§å°±æ˜¯500MB
- âŒ **ä¸é€‚åˆååŒ**ï¼šå¤šäººç¼–è¾‘æ—¶æ— æ³•åˆå¹¶å¿«ç…§

#### é€‚ç”¨åœºæ™¯

- ä¸ªäººç¼–è¾‘å™¨
- æ–‡æ¡£ä¸æ˜¯ç‰¹åˆ«å¤§ï¼ˆ< 1MBï¼‰
- å†å²æ ˆä¸æ˜¯ç‰¹åˆ«æ·±ï¼ˆ< 100 ä¸ªæ“ä½œï¼‰

#### å®ç°ç¤ºæ„

```typescript
// å†å²æ ˆç»“æ„
transactions = [
  { id: '1', content: 'åˆå§‹å†…å®¹', timestamp: 1000 },
  { id: '2', content: 'åˆå§‹å†…å®¹\næ–°å¢ä¸€è¡Œ', timestamp: 2000 },
  { id: '3', content: 'åˆå§‹å†…å®¹\næ–°å¢ä¸€è¡Œ\nå†åŠ ä¸€è¡Œ', timestamp: 3000 },
]
currentIndex = 2  // å½“å‰åœ¨å­˜æ¡£3

// æ’¤é”€
undo() {
  currentIndex--  // å›åˆ°å­˜æ¡£2
  editorContent = transactions[currentIndex].content  // ç›´æ¥æ›¿æ¢
}

// é‡åš
redo() {
  currentIndex++  // å‰è¿›åˆ°å­˜æ¡£3
  editorContent = transactions[currentIndex].content  // ç›´æ¥æ›¿æ¢
}
```

---

### 3.2 æ–¹æ¡ˆäºŒï¼šå¢é‡å¼ï¼ˆIncremental-basedï¼‰âš¡ï¸ é«˜çº§ä¼˜åŒ–

**åŸç†**ï¼šä¸ä¿å­˜å®Œæ•´å†…å®¹ï¼Œåªä¿å­˜**æ“ä½œå¢é‡**ï¼ˆDeltaï¼‰ã€‚

#### æ ¸å¿ƒæ€æƒ³

```
åˆå§‹çŠ¶æ€: "Hello"

æ“ä½œ1: åœ¨ä½ç½®5æ’å…¥" World"  â†’  Delta: { type: 'insert', pos: 5, text: ' World' }
æ“ä½œ2: åˆ é™¤ä½ç½®0-5çš„æ–‡å­—    â†’  Delta: { type: 'delete', start: 0, end: 5, text: 'Hello' }
æ“ä½œ3: åœ¨ä½ç½®0æ’å…¥"Hi"     â†’  Delta: { type: 'insert', pos: 0, text: 'Hi' }

ç»“æœ: "Hi World"
```

#### ä¼˜ç‚¹

- âœ… **å†…å­˜å ç”¨å°**ï¼šåªå­˜å‚¨æ“ä½œå·®å¼‚ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–‡æ¡£
- âœ… **æ”¯æŒååŒ**ï¼šå¯ä»¥åˆå¹¶æ¥è‡ªä¸åŒç”¨æˆ·çš„æ“ä½œ
- âœ… **å¯ä»¥åšé«˜çº§åŠŸèƒ½**ï¼šå¦‚ Operational Transformï¼ˆOTï¼‰ã€CRDT

#### ç¼ºç‚¹

- âŒ **å®ç°å¤æ‚**ï¼šéœ€è¦å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
- âŒ **æ¢å¤æ…¢**ï¼šæ’¤é”€æ—¶éœ€è¦é€ä¸ªåå‘åº”ç”¨æ“ä½œ
- âŒ **å®¹æ˜“å‡ºé”™**ï¼šå¢é‡è®¡ç®—å¦‚æœæœ‰ bugï¼Œä¼šå¯¼è‡´å†…å®¹é”™ä¹±

#### é€‚ç”¨åœºæ™¯

- ååŒç¼–è¾‘å™¨ï¼ˆGoogle Docsã€Notionï¼‰
- å¤§æ–‡æ¡£ç¼–è¾‘ï¼ˆå‡ åMBï¼‰
- éœ€è¦æ— é™å†å²è®°å½•çš„åœºæ™¯

---

### 3.3 æˆ‘ä»¬çš„é€‰æ‹©ï¼šå…ˆå¿«ç…§ï¼Œåä¼˜åŒ–

**ç¬¬ä¸€é˜¶æ®µï¼ˆå½“å‰ï¼‰**ï¼š

- ä½¿ç”¨**å¿«ç…§å¼**å¿«é€Ÿå®ç°åŠŸèƒ½
- éªŒè¯äº¤äº’æµç¨‹å’Œ UI é€»è¾‘

**ç¬¬äºŒé˜¶æ®µï¼ˆä¼˜åŒ–ï¼‰**ï¼š

- å¦‚æœå‘ç°å†…å­˜å ç”¨å¤ªå¤§ï¼Œå†åˆ‡æ¢åˆ°**å¢é‡å¼**
- æˆ–è€…é‡‡ç”¨**æ··åˆæ–¹æ¡ˆ**ï¼ˆå¿«ç…§ + å¢é‡ï¼‰

> **å·¥ç¨‹åŸåˆ™**ï¼šä¸è¦è¿‡æ—©ä¼˜åŒ–ã€‚å…ˆè·‘é€šåŠŸèƒ½ï¼Œå†ä¼˜åŒ–æ€§èƒ½ã€‚

---

## å››ã€å¿«ç…§å¼æ–¹æ¡ˆè¯¦ç»†è®¾è®¡

### 4.1 æ ¸å¿ƒæ•°æ®ç»“æ„

å‚è€ƒ `types/editor.ts` ä¸­çš„å®šä¹‰ï¼š

```typescript
// EditTransaction: ä¸€ä¸ª"å­˜æ¡£ç‚¹"
interface EditTransaction {
  id: string // å”¯ä¸€æ ‡è¯†
  label: string // æè¿°ï¼ˆå¦‚ "è¾“å…¥æ–‡æœ¬"ã€"åº”ç”¨åŠ ç²—"ï¼‰
  content: string // âš ï¸ å¿«ç…§å¼ï¼šå­˜å‚¨å®Œæ•´å†…å®¹
  timestamp: number // æ—¶é—´æˆ³
}

// EditorHistory: å†å²ç®¡ç†å™¨
interface EditorHistory {
  transactions: EditTransaction[] // æ‰€æœ‰å­˜æ¡£ç‚¹
  currentIndex: number // å½“å‰æŒ‡é’ˆä½ç½®
}
```

### 4.2 æŒ‡é’ˆä½ç½®çš„å«ä¹‰

**å…³é”®ç†è§£**ï¼š`currentIndex` è¡¨ç¤º"å½“å‰å¤„äºå“ªä¸ª transaction ä¹‹å"ã€‚

```
transactions = [T0, T1, T2, T3, T4]
currentIndex = 2

å«ä¹‰ï¼šæˆ‘ä»¬ç°åœ¨å¤„äº T2 è¿™ä¸ªçŠ¶æ€
      â†“
  [T0, T1, T2, T3, T4]
           â†‘
        å½“å‰çŠ¶æ€

å¯ä»¥æ’¤é”€ï¼šT2 â†’ T1 â†’ T0
å¯ä»¥é‡åšï¼šT2 â†’ T3 â†’ T4
```

**ç‰¹æ®Šå€¼**ï¼š

- `currentIndex = -1`ï¼šåˆå§‹çŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•æ“ä½œ
- `currentIndex = transactions.length - 1`ï¼šæœ€æ–°çŠ¶æ€ï¼Œä¸èƒ½é‡åš

### 4.3 æ ¸å¿ƒæ–¹æ³•å®ç°é€»è¾‘

#### 4.3.1 Push Transactionï¼ˆè®°å½•æ–°æ“ä½œï¼‰

```typescript
pushTransaction(content: string, label: string) {
  // 1. åˆ›å»ºæ–°çš„ transaction
  const newTransaction = {
    id: generateId(),
    label,
    content,  // âš ï¸ å¿«ç…§å¼ï¼šå­˜å‚¨å®Œæ•´å†…å®¹
    timestamp: Date.now(),
  }

  // 2. âš ï¸ å…³é”®ï¼šä¸¢å¼ƒ currentIndex ä¹‹åçš„æ‰€æœ‰ transactions
  //    ï¼ˆå› ä¸ºå†å²è¢«æ”¹å˜äº†ï¼‰
  transactions = transactions.slice(0, currentIndex + 1)

  // 3. æ·»åŠ æ–° transaction
  transactions.push(newTransaction)

  // 4. æŒ‡é’ˆç§»åŠ¨åˆ°æœ€æ–°ä½ç½®
  currentIndex = transactions.length - 1
}
```

**ç¤ºæ„å›¾**ï¼š

```
åˆå§‹çŠ¶æ€ï¼š
transactions = [T0, T1, T2, T3]
currentIndex = 1  (å¤„äº T1)

ç”¨æˆ·è¿›è¡Œäº†æ–°æ“ä½œ T_newï¼š

æ­¥éª¤1: slice(0, 2) â†’ [T0, T1]  ï¼ˆä¸¢å¼ƒ T2, T3ï¼‰
æ­¥éª¤2: push(T_new) â†’ [T0, T1, T_new]
æ­¥éª¤3: currentIndex = 2
```

#### 4.3.2 Undoï¼ˆæ’¤é”€ï¼‰

```typescript
undo() {
  // 1. æ£€æŸ¥æ˜¯å¦å¯ä»¥æ’¤é”€
  if (currentIndex < 0) return null

  // 2. æŒ‡é’ˆåé€€
  currentIndex--

  // 3. è¿”å›æ–°çš„çŠ¶æ€
  if (currentIndex === -1) {
    return ''  // å›åˆ°åˆå§‹ç©ºç™½çŠ¶æ€
  } else {
    return transactions[currentIndex].content
  }
}
```

**ç¤ºæ„å›¾**ï¼š

```
transactions = [T0, T1, T2]
currentIndex = 2

æ‰§è¡Œ undo():
  currentIndex-- â†’ currentIndex = 1
  è¿”å› transactions[1].content
```

#### 4.3.3 Redoï¼ˆé‡åšï¼‰

```typescript
redo() {
  // 1. æ£€æŸ¥æ˜¯å¦å¯ä»¥é‡åš
  if (currentIndex >= transactions.length - 1) return null

  // 2. æŒ‡é’ˆå‰è¿›
  currentIndex++

  // 3. è¿”å›æ–°çš„çŠ¶æ€
  return transactions[currentIndex].content
}
```

### 4.4 è¾¹ç•Œæƒ…å†µå¤„ç†

| åœºæ™¯         | currentIndex | canUndo | canRedo | è¯´æ˜           |
| ------------ | ------------ | ------- | ------- | -------------- |
| åˆå§‹çŠ¶æ€     | -1           | âŒ      | âŒ      | æ²¡æœ‰ä»»ä½•æ“ä½œ   |
| ç¬¬ä¸€æ¬¡æ“ä½œå | 0            | âœ…      | âŒ      | å¯ä»¥æ’¤é”€åˆ°ç©ºç™½ |
| ä¸­é—´çŠ¶æ€     | 1            | âœ…      | âœ…      | å¯ä»¥å‰åç§»åŠ¨   |
| æœ€æ–°çŠ¶æ€     | length-1     | âœ…      | âŒ      | ä¸èƒ½é‡åš       |
| æ’¤é”€åæ–°æ“ä½œ | -            | -       | âŒ      | é‡åšå†å²è¢«æ¸…ç©º |

---

## äº”ã€å¦‚ä½•é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿï¼Ÿ

### 5.1 æ¨¡å—èŒè´£åˆ’åˆ†

```
useHistory.ts          â†’ æ ¸å¿ƒå†å²ç®¡ç†é€»è¾‘
    â†“
EditorContent.vue      â†’ åˆå§‹åŒ– useHistoryï¼Œæš´éœ² undo/redo API
    â†“
useMarkdown.ts         â†’ æ¯æ¬¡æ ¼å¼åŒ–æ“ä½œåï¼Œè°ƒç”¨ pushTransaction
    â†“
handleInput()          â†’ ç”¨æˆ·è¾“å…¥æ—¶ï¼Œè°ƒç”¨ pushTransaction
```

### 5.2 æ•°æ®æµç¤ºæ„å›¾

```
ç”¨æˆ·æŒ‰ä¸‹ Ctrl+Bï¼ˆåŠ ç²—ï¼‰
    â†“
EditorToolbar emit('inline-format', 'bold')
    â†“
MarkdownEditor â†’ editorContentRef.applyInlineFormat('bold')
    â†“
EditorContent â†’ markdownAPI.applyInlineFormat('bold')
    â†“
useMarkdown.applyInlineFormat()
    â”œâ”€ 1. åº”ç”¨æ ¼å¼ï¼ˆä¿®æ”¹ DOMï¼‰
    â”œâ”€ 2. æ›´æ–° state.content
    â””â”€ 3. âš ï¸ æ–°å¢ï¼šè°ƒç”¨ historyModule.pushTransaction(state.content, 'åº”ç”¨åŠ ç²—')
            â†“
    useHistory.pushTransaction()
        â”œâ”€ åˆ›å»ºæ–° transaction
        â”œâ”€ ä¸¢å¼ƒæ—§çš„"æœªæ¥"
        â””â”€ æ›´æ–° currentIndex
```

### 5.3 å…³é”®é›†æˆç‚¹

#### 5.3.1 åœ¨ EditorContent.vue åˆå§‹åŒ–

```vue
<script setup>
import { useHistory } from './composables/useHistory'

const editorState = reactive({ ... })
const selectionModule = useSelection(...)

// âš ï¸ æ–°å¢ï¼šåˆå§‹åŒ–å†å²ç®¡ç†
const historyModule = useHistory(editorState)

// ä¼ é€’ç»™ useMarkdown
const markdownModule = useMarkdown(editorState, selectionModule, historyModule)

// æš´éœ²ç»™çˆ¶ç»„ä»¶
defineExpose({
  ...markdownModule,
  ...historyModule,  // âš ï¸ æš´éœ² undo/redo æ–¹æ³•
})
</script>
```

#### 5.3.2 åœ¨ useMarkdown ä¸­è®°å½•å†å²

```typescript
export function useMarkdown(
  state: EditorState,
  selectionModule: UseSelectionReturn,
  historyModule: UseHistoryReturn, // âš ï¸ æ–°å¢å‚æ•°
) {
  const applyInlineFormat = (action: InlineFormatType) => {
    // ... åŸæœ‰é€»è¾‘ ...
    replaceRange(start, end, newText)

    // âš ï¸ æ–°å¢ï¼šè®°å½•åˆ°å†å²
    historyModule.pushTransaction(state.content, `åº”ç”¨${action}æ ¼å¼`)
  }
}
```

#### 5.3.3 å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆæœ€éš¾çš„éƒ¨åˆ†ï¼‰

**é—®é¢˜**ï¼šç”¨æˆ·è¿ç»­è¾“å…¥"hello"ï¼Œåº”è¯¥è®°å½•ä¸º1ä¸ª transaction è¿˜æ˜¯5ä¸ªï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨**é˜²æŠ–ï¼ˆDebounceï¼‰**åˆå¹¶è¿ç»­è¾“å…¥ã€‚

```typescript
// EditorContent.vue
let inputTimer: number | null = null

const handleInput = () => {
  const newContent = editorRef.value.innerHTML

  // ç«‹å³æ›´æ–°æ˜¾ç¤º
  emit('update:modelValue', newContent)
  state.content = newContent

  // âš ï¸ é˜²æŠ–è®°å½•å†å²ï¼ˆ500ms å†…çš„è¾“å…¥åˆå¹¶ä¸ºä¸€ä¸ª transactionï¼‰
  if (inputTimer) clearTimeout(inputTimer)

  inputTimer = setTimeout(() => {
    historyModule.pushTransaction(newContent, 'è¾“å…¥æ–‡æœ¬')
  }, 500)
}
```

---

## å…­ã€å®ç°æ­¥éª¤è§„åˆ’

### é˜¶æ®µä¸€ï¼šå®ç° useHistory æ ¸å¿ƒé€»è¾‘

- [ ] å®šä¹‰ stateï¼ˆtransactions, currentIndexï¼‰
- [ ] å®ç° `pushTransaction()`
- [ ] å®ç° `undo()`
- [ ] å®ç° `redo()`
- [ ] å®ç° `canUndo` / `canRedo` è®¡ç®—å±æ€§

### é˜¶æ®µäºŒï¼šé›†æˆåˆ° EditorContent

- [ ] åœ¨ `EditorContent.vue` åˆå§‹åŒ– `useHistory`
- [ ] æš´éœ² `undo/redo` ç»™çˆ¶ç»„ä»¶
- [ ] ç»‘å®šå¿«æ·é”® `Ctrl+Z` / `Ctrl+Shift+Z`

### é˜¶æ®µä¸‰ï¼šåœ¨ useMarkdown ä¸­è®°å½•æ“ä½œ

- [ ] ä¿®æ”¹ `applyInlineFormat` è°ƒç”¨ `pushTransaction`
- [ ] ä¿®æ”¹ `applyParagraphFormat` è°ƒç”¨ `pushTransaction`
- [ ] ä¿®æ”¹ `insertBlock` è°ƒç”¨ `pushTransaction`

### é˜¶æ®µå››ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥

- [ ] åœ¨ `handleInput` ä¸­æ·»åŠ é˜²æŠ–é€»è¾‘
- [ ] æµ‹è¯•è¿ç»­è¾“å…¥çš„åˆå¹¶æ•ˆæœ

### é˜¶æ®µäº”ï¼šUI é›†æˆ

- [ ] åœ¨å·¥å…·æ æ·»åŠ æ’¤é”€/é‡åšæŒ‰é’®
- [ ] æ ¹æ® `canUndo/canRedo` ç¦ç”¨æŒ‰é’®
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

---

## ä¸ƒã€å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### Q1: ä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠæ¯æ¬¡ `input` äº‹ä»¶éƒ½è®°å½•ï¼Ÿ

**A**: ä¼šå¯¼è‡´å†å²æ ˆçˆ†ç‚¸ã€‚ç”¨æˆ·è¾“å…¥"hello"äº§ç”Ÿ5ä¸ªå¿«ç…§ï¼Œæ’¤é”€ä¸€æ¬¡åªé€€ä¸€ä¸ªå­—æ¯ï¼Œä½“éªŒå¾ˆå·®ã€‚

### Q2: é˜²æŠ–æ—¶é—´è®¾ç½®å¤šå°‘åˆé€‚ï¼Ÿ

**A**: 500ms æ˜¯ç»éªŒå€¼ã€‚å¤ªçŸ­ï¼ˆå¦‚100msï¼‰ä¼šå¯¼è‡´å¿«ç…§è¿‡å¤šï¼›å¤ªé•¿ï¼ˆå¦‚2000msï¼‰ä¼šè®©ç”¨æˆ·è§‰å¾—å¡é¡¿ã€‚

### Q3: å¦‚æœç”¨æˆ·åœ¨é˜²æŠ–æœŸé—´æ’¤é”€æ€ä¹ˆåŠï¼Ÿ

**A**: éœ€è¦ç«‹å³æ¸…é™¤é˜²æŠ–å®šæ—¶å™¨ï¼Œå¹¶å¼ºåˆ¶è®°å½•å½“å‰çŠ¶æ€ï¼Œç„¶åå†æ‰§è¡Œæ’¤é”€ã€‚

### Q4: å†å²æ ˆåº”è¯¥ä¿å­˜å¤šå°‘ä¸ªå¿«ç…§ï¼Ÿ

**A**: å»ºè®® 50-100 ä¸ªã€‚è¶…è¿‡é™åˆ¶åï¼Œåˆ é™¤æœ€æ—©çš„å¿«ç…§ï¼ˆFIFO é˜Ÿåˆ—ï¼‰ã€‚

### Q5: å¿«ç…§å¼æ–¹æ¡ˆçš„å†…å­˜å ç”¨çœŸçš„å¾ˆå¤§å—ï¼Ÿ

**A**: å¯¹äºæ™®é€šæ–‡ç« ï¼ˆ< 100KBï¼‰ï¼Œä¿å­˜50ä¸ªå¿«ç…§åªå ç”¨ 5MBï¼Œå®Œå…¨å¯ä»¥æ¥å—ã€‚åªæœ‰è¶…å¤§æ–‡æ¡£ï¼ˆ> 1MBï¼‰æ‰éœ€è¦è€ƒè™‘ä¼˜åŒ–ã€‚

---

## å…«ã€æŠ€æœ¯å‚è€ƒ

### ä¸šç•Œå®ç°

- **VS Code**: [Text Buffer & Undo/Redo](https://code.visualstudio.com/blogs/2018/03/23/text-buffer-reimplementation)
- **ProseMirror**: [Step-based History](https://prosemirror.net/docs/guide/#transform)
- **Quill**: [Delta-based History](https://github.com/quilljs/delta)

### æ ¸å¿ƒåŸç†

- **Command Pattern**ï¼ˆå‘½ä»¤æ¨¡å¼ï¼‰ï¼šå°†æ“ä½œå°è£…ä¸ºå¯¹è±¡
- **Memento Pattern**ï¼ˆå¤‡å¿˜å½•æ¨¡å¼ï¼‰ï¼šä¿å­˜å’Œæ¢å¤çŠ¶æ€

---

## ä¹ã€æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å¿«ç…§å¼æ–¹æ¡ˆ**ï¼šç®€å•ã€å¯é ã€é€‚åˆç¬¬ä¸€ç‰ˆå®ç°
2. **æŒ‡é’ˆç®¡ç†**ï¼š`currentIndex` æ˜¯å…³é”®ï¼Œç†è§£æ¸…æ¥šå®ƒçš„å«ä¹‰
3. **é˜²æŠ–åˆå¹¶**ï¼šç”¨æˆ·è¾“å…¥éœ€è¦åˆå¹¶ï¼Œé¿å…å¿«ç…§çˆ†ç‚¸
4. **è¾¹ç•Œå¤„ç†**ï¼šåˆå§‹çŠ¶æ€ã€ç©ºæ ˆã€æ»¡æ ˆçš„ç‰¹æ®Šæƒ…å†µ

### ä¸‹ä¸€æ­¥

- æ‰“å¼€ `useHistory.ts`
- æ ¹æ®æœ¬æ–‡æ¡£ï¼Œå®ç°æ ¸å¿ƒçš„ `pushTransaction`ã€`undo`ã€`redo` æ–¹æ³•
- å…ˆä¸è¦æ€¥ç€é›†æˆï¼Œå•ç‹¬æµ‹è¯•è¿™ä¸‰ä¸ªæ–¹æ³•çš„é€»è¾‘æ­£ç¡®æ€§

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹ç¼–ç å§ï¼** ğŸš€
